# MailZen Backend env example
# ------------------------------------------------------------
# Copy to `apps/backend/.env` and adjust values for your environment.
# This file mirrors the defaults created by `tools/ensure-env.js`.

DATABASE_URL=postgresql://postgres:postgres@localhost:5432/mailzen?schema=public

# Server Configuration
PORT=4000
NODE_ENV=development

# Frontend URL for CORS
FRONTEND_URL=http://localhost:3000
GLOBAL_RATE_LIMIT_ENABLED=true
GLOBAL_RATE_LIMIT_WINDOW_MS=60000
GLOBAL_RATE_LIMIT_MAX_REQUESTS=300
GLOBAL_RATE_LIMIT_EXCLUDED_PATHS=/auth/google/callback,/auth/microsoft/callback

# JWT Secret for Authentication
JWT_SECRET=replace-with-at-least-32-characters
JWT_EXPIRATION=86400
MAILZEN_SMS_PROVIDER=CONSOLE
MAILZEN_SMS_FALLBACK_PROVIDER=
MAILZEN_SMS_STRICT_DELIVERY=false
MAILZEN_SMS_WEBHOOK_URL=
MAILZEN_SMS_WEBHOOK_TOKEN=
MAILZEN_SMS_WEBHOOK_TIMEOUT_MS=5000
MAILZEN_SMS_WEBHOOK_SIGNING_KEY=
MAILZEN_SMS_TWILIO_ACCOUNT_SID=
MAILZEN_SMS_TWILIO_AUTH_TOKEN=
MAILZEN_SMS_TWILIO_FROM_NUMBER=
MAILZEN_SMS_TWILIO_API_BASE_URL=https://api.twilio.com
MAILZEN_SMS_TWILIO_TIMEOUT_MS=5000
MAILZEN_SMS_TWILIO_STATUS_CALLBACK_URL=

# Shared secret key for mailbox/provider credential encryption (>=32 chars)
SECRETS_KEY=replace-with-at-least-32-characters
PROVIDER_SECRETS_KEY=replace-with-at-least-32-characters
# Optional keyring format for rotation: keyId:32+charSecret,keyId2:32+charSecret
PROVIDER_SECRETS_KEYRING=
PROVIDER_SECRETS_ACTIVE_KEY_ID=default

# OAuth providers
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_REDIRECT_URI=http://localhost:4000/auth/google/callback
GOOGLE_PROVIDER_REDIRECT_URI=http://localhost:4000/email-integration/google/callback

OUTLOOK_CLIENT_ID=
OUTLOOK_CLIENT_SECRET=
OUTLOOK_REDIRECT_URI=http://localhost:4000/auth/microsoft/callback
OUTLOOK_PROVIDER_REDIRECT_URI=http://localhost:4000/email-integration/microsoft/callback
# Provider sync scheduler lease + retry tuning
PROVIDER_SYNC_LEASE_TTL_MS=540000
GMAIL_SYNC_SCHEDULER_RETRIES=1
GMAIL_SYNC_SCHEDULER_RETRY_BACKOFF_MS=250
GMAIL_SYNC_SCHEDULER_JITTER_MS=150
GMAIL_PUSH_WEBHOOK_TOKEN=
GMAIL_PUSH_SYNC_MAX_MESSAGES=25
GMAIL_PUSH_TOPIC_NAME=
GMAIL_PUSH_WATCH_RENEW_THRESHOLD_MINUTES=60
GMAIL_PUSH_WATCH_LABEL_IDS=INBOX
OUTLOOK_SYNC_SCHEDULER_RETRIES=1
OUTLOOK_SYNC_SCHEDULER_RETRY_BACKOFF_MS=250
OUTLOOK_SYNC_SCHEDULER_JITTER_MS=150
OUTLOOK_SYNC_DELTA_PAGE_LIMIT=5
OUTLOOK_PUSH_WEBHOOK_TOKEN=
OUTLOOK_PUSH_SYNC_MAX_MESSAGES=25
OUTLOOK_PUSH_NOTIFICATION_URL=
OUTLOOK_PUSH_CLIENT_STATE_SECRET=
OUTLOOK_PUSH_SUBSCRIPTION_DURATION_MINUTES=2880
OUTLOOK_PUSH_SUBSCRIPTION_RENEW_THRESHOLD_MINUTES=120

# AI gateway / platform integration
AI_AGENT_PLATFORM_URL=http://localhost:8100
AI_AGENT_PLATFORM_URLS=
AI_AGENT_PLATFORM_LOAD_BALANCE_ENABLED=false
AI_AGENT_PLATFORM_KEY=
AI_AGENT_PLATFORM_TIMEOUT_MS=4000
AI_AGENT_PLATFORM_RETRIES=1
AI_AGENT_PLATFORM_CHECK_ON_STARTUP=true
AI_AGENT_PLATFORM_REQUIRED=false
AI_AGENT_GATEWAY_RATE_LIMIT=40
AI_AGENT_GATEWAY_USE_REDIS=true
AI_AGENT_GATEWAY_REDIS_URL=redis://localhost:6379
AI_AGENT_ACTION_APPROVAL_TTL_SECONDS=600
AI_AGENT_THREAD_CONTEXT_CACHE_TTL_MS=300000
AI_AGENT_CREDIT_COST=1
# Optional per-skill overrides (normalized uppercase skill key)
# AI_AGENT_CREDIT_COST_INBOX=2
AI_AGENT_HEALTH_SAMPLE_PERSIST_ENABLED=true
AI_AGENT_HEALTH_SAMPLE_AUTOPURGE_ENABLED=true
AI_AGENT_HEALTH_SAMPLE_RETENTION_DAYS=30
AI_AGENT_ACTION_AUDIT_AUTOPURGE_ENABLED=true
AI_AGENT_ACTION_AUDIT_RETENTION_DAYS=365
# Optional shared secret for REST billing webhooks:
# POST /billing/webhooks/:provider must include matching x-billing-webhook-secret
# BILLING_WEBHOOK_SHARED_SECRET=replace-with-strong-secret
# Billing compliance retention controls
BILLING_RETENTION_AUTOPURGE_ENABLED=true
BILLING_WEBHOOK_RETENTION_DAYS=120
BILLING_AI_USAGE_RETENTION_MONTHS=36
AI_AGENT_ALERT_LATENCY_MS=1500
AI_AGENT_ALERT_ERROR_RATE_PERCENT=5
AI_AGENT_HEALTH_ALERTS_ENABLED=true
AI_AGENT_HEALTH_ALERT_WINDOW_HOURS=6
AI_AGENT_HEALTH_ALERT_BASELINE_WINDOW_HOURS=72
AI_AGENT_HEALTH_ALERT_COOLDOWN_MINUTES=60
AI_AGENT_HEALTH_ALERT_MIN_SAMPLE_COUNT=4
AI_AGENT_HEALTH_ALERT_ANOMALY_MULTIPLIER=2
AI_AGENT_HEALTH_ALERT_ANOMALY_MIN_ERROR_RATE_DELTA_PERCENT=1
AI_AGENT_HEALTH_ALERT_ANOMALY_MIN_LATENCY_DELTA_MS=150
AI_AGENT_HEALTH_ALERT_SCAN_ADMIN_USERS=true
AI_AGENT_HEALTH_ALERT_RECIPIENT_USER_IDS=
AI_AGENT_HEALTH_ALERT_RUN_AUTOPURGE_ENABLED=true
AI_AGENT_HEALTH_ALERT_RUN_RETENTION_DAYS=120

# Smart-reply external adapter flags
SMART_REPLY_USE_AGENT_PLATFORM=false
SMART_REPLY_USE_OPENAI=false
SMART_REPLY_OPENAI_API_KEY=
SMART_REPLY_OPENAI_MODEL=gpt-4o-mini
SMART_REPLY_OPENAI_BASE_URL=https://api.openai.com/v1
SMART_REPLY_OPENAI_TIMEOUT_MS=4500
SMART_REPLY_USE_AZURE_OPENAI=false
SMART_REPLY_AZURE_OPENAI_API_KEY=
SMART_REPLY_AZURE_OPENAI_ENDPOINT=
SMART_REPLY_AZURE_OPENAI_DEPLOYMENT=
SMART_REPLY_AZURE_OPENAI_API_VERSION=2024-08-01-preview
SMART_REPLY_AZURE_OPENAI_TIMEOUT_MS=4500
SMART_REPLY_USE_ANTHROPIC=false
SMART_REPLY_ANTHROPIC_API_KEY=
SMART_REPLY_ANTHROPIC_MODEL=claude-3-5-haiku-latest
SMART_REPLY_ANTHROPIC_BASE_URL=https://api.anthropic.com/v1
SMART_REPLY_ANTHROPIC_TIMEOUT_MS=4500
SMART_REPLY_ANTHROPIC_MAX_TOKENS=320
SMART_REPLY_HYBRID_PRIMARY=openai
SMART_REPLY_PROVIDER_MODE=hybrid
SMART_REPLY_EXTERNAL_TIMEOUT_MS=3000
MAILZEN_SMART_REPLY_HISTORY_AUTOPURGE_ENABLED=true
MAILZEN_SMART_REPLY_HISTORY_RETENTION_DAYS=365

# Optional external mail-admin API for @mailzen provisioning
MAILZEN_MAIL_ADMIN_API_URL=
MAILZEN_MAIL_ADMIN_API_URLS=
MAILZEN_MAIL_ADMIN_REQUIRED=false
MAILZEN_MAIL_ADMIN_API_TOKEN=
MAILZEN_MAIL_ADMIN_API_TOKEN_HEADER=authorization
MAILZEN_MAIL_ADMIN_PROVIDER=GENERIC
MAILZEN_MAIL_ADMIN_API_TIMEOUT_MS=5000
MAILZEN_MAIL_ADMIN_API_RETRIES=2
MAILZEN_MAIL_ADMIN_API_RETRY_BACKOFF_MS=300
MAILZEN_MAIL_ADMIN_API_RETRY_JITTER_MS=150
MAILZEN_MAIL_ADMIN_MAILCOW_QUOTA_MB=51200
MAILZEN_MAILBOX_SYNC_ENABLED=false
MAILZEN_MAIL_SYNC_API_URL=
MAILZEN_MAIL_SYNC_API_TOKEN=
MAILZEN_MAIL_SYNC_API_TOKEN_HEADER=authorization
MAILZEN_MAIL_SYNC_TIMEOUT_MS=5000
MAILZEN_MAIL_SYNC_RETRIES=2
MAILZEN_MAIL_SYNC_RETRY_BACKOFF_MS=250
MAILZEN_MAIL_SYNC_RETRY_JITTER_MS=125
MAILZEN_MAIL_SYNC_FAIL_FAST=true
MAILZEN_MAIL_SYNC_LEASE_TTL_SECONDS=180
MAILZEN_MAIL_SYNC_BATCH_LIMIT=25
MAILZEN_MAIL_SYNC_MAX_MAILBOXES_PER_RUN=250
MAILZEN_MAIL_SYNC_CURSOR_PARAM=cursor
MAILZEN_INBOUND_WEBHOOK_TOKEN=
MAILZEN_INBOUND_WEBHOOK_SIGNING_KEY=
MAILZEN_INBOUND_WEBHOOK_SIGNATURE_TOLERANCE_MS=300000
MAILZEN_INBOUND_IDEMPOTENCY_TTL_MS=86400000
MAILZEN_INBOUND_SLA_TARGET_SUCCESS_PERCENT=99
MAILZEN_INBOUND_SLA_WARNING_REJECTION_PERCENT=1
MAILZEN_INBOUND_SLA_CRITICAL_REJECTION_PERCENT=5
MAILZEN_INBOUND_SLA_ALERT_WINDOW_HOURS=24
MAILZEN_INBOUND_SLA_ALERT_COOLDOWN_MINUTES=60
MAILZEN_INBOUND_SLA_ALERT_MAX_USERS_PER_RUN=500
MAILZEN_MAILBOX_INBOUND_RETENTION_AUTOPURGE_ENABLED=true
MAILZEN_MAILBOX_INBOUND_RETENTION_DAYS=180
MAILZEN_NOTIFICATION_DIGEST_WINDOW_HOURS=24
MAILZEN_NOTIFICATION_DIGEST_MAX_USERS_PER_RUN=250
MAILZEN_NOTIFICATION_DIGEST_MAX_ITEMS=8
MAILZEN_NOTIFICATION_RETENTION_AUTOPURGE_ENABLED=true
MAILZEN_NOTIFICATION_RETENTION_DAYS=180
MAILZEN_NOTIFICATION_PUSH_RETENTION_DAYS=90
MAILZEN_NOTIFICATION_WEBHOOK_URL=
MAILZEN_NOTIFICATION_WEBHOOK_TOKEN=
MAILZEN_NOTIFICATION_WEBHOOK_TIMEOUT_MS=3000
MAILZEN_NOTIFICATION_WEBHOOK_RETRIES=2
MAILZEN_NOTIFICATION_WEBHOOK_SIGNING_KEY=
MAILZEN_WEB_PUSH_ENABLED=false
MAILZEN_WEB_PUSH_VAPID_PUBLIC_KEY=
MAILZEN_WEB_PUSH_VAPID_PRIVATE_KEY=
MAILZEN_WEB_PUSH_VAPID_SUBJECT=mailto:alerts@mailzen.com
MAILZEN_WEB_PUSH_MAX_FAILURE_COUNT=8
MAILZEN_WEB_PUSH_MAX_SUBSCRIPTIONS_PER_USER=8

# Feature Flags (should match frontend)
ENABLE_EMAIL_WARMUP=true
ENABLE_SMART_REPLIES=true
ENABLE_EMAIL_TRACKING=true

